{% extends "masanga_base.html" %}
{% load humanize %}

{% block title %}
{{ user.username }}
{% endblock %}

{% block head %}
{{ user.username }}
{% endblock %}

{% block body %}
{% if user.is_public or own_page%}

    {% if is_runner %}

        Sponsorships Recieved: </br>
        <table class="table table-hover">
            <thead>
                <th>Sponsor</th>
                <th>Rate(kr/km)</th>
                <th>Maximum Possible Amount (kr)</th>
                <th>Started</th>
                <th>Continues Until</th>
                <th>Amount Earned (kr)</th>

            </thead>

            {% for sponsorship in sponsorships %}
                {% if sponsorship.sponsor.is_public or own_page or sponsorship.sponsor == accessor %}
                    {% if sponsorship.is_active %}
                        <tr> 
                            <td>{{ sponsorship.sponsor }}</td>
                            <td>{{ sponsorship.rate }}</td>
                            <td>{{ sponsorship.max_amount }}</td>
                            <td>{{ sponsorship.start_date }}</td>
                            <td>{{ sponsorship.end_date }}</td>
                            <td>{{ sponsorship.total_amount|floatformat:-2|intcomma }}</td>

                            {% if own_page or sponsorship.sponsor == accessor %}
                                <td><a href="{% url 'Running.views.end_sponsorship' sponsorship.id user.id %}" class="btn btn-default">End Sponsorship</a></td>
                            {% endif %}
                        </tr>

                    {% else %}
                        <tr style='opacity:0.6'> 
                            <td>{{ sponsorship.sponsor }}</td>
                            <td>{{ sponsorship.rate }}</td>
                            <td>{{ sponsorship.max_amount }}</td>
                            <td>{{ sponsorship.start_date }}</td>
                            <td>{{ sponsorship.end_date }}</td>
                            <td>{{ sponsorship.total_amount|floatformat:-2|intcomma }}</td>

                        </tr>
                    {% endif %}

                {% else %}
                    {% if sponsorship.is_active %}

                        <tr>
                            <td>Anonymous Sponsor</td>
                            <td>{{ sponsorship.rate }}</td>
                            <td>{{ sponsorship.max_amount }}</td>
                            <td>{{ sponsorship.start_date }}</td>
                            <td>{{ sponsorship.end_date }}</td>
                            <td>{{ sponsorship.total_amount|floatformat:-2|intcomma }}</td>

                        </tr>
                    {% else %}
                        <tr style='opacity:0.6'> 
                                <td>{{ sponsorship.sponsor }}</td>
                                <td>{{ sponsorship.rate }}</td>
                                <td>{{ sponsorship.max_amount }}</td>
                                <td>{{ sponsorship.start_date }}</td>
                                <td>{{ sponsorship.end_date }}</td>
                                <td>{{ sponsorship.total_amount|floatformat:-2|intcomma }}</td>
                        </tr>
                    {% endif %}
                {% endif %}

            {% empty %}
                <tr><td>Hmm, there don't seem to be any sponsorships here.</td></tr>
            {% endfor %}
            {% if sponsorships %}
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td align='right'>Total Amount Earned: </td>
                    <td>{{ amount_earned|floatformat:-2|intcomma }}kr</td>
                </tr>
            {% endif %}
        </table>

        {% if own_page %}
        {% else %}
            <h4><a href="{% url 'Running.views.sponsor' user.id %}" class="btn btn-default"> Sponsor {{ user.username }}! </a></h4>
            </br>
        {% endif %}


        Runs:</br>

        <table class="table table-hover">
            <tr>
                <th>Distance (km)</th>
                <th>Date</th>
            </tr>
        {% for run in runs %}
                <tr> 
                    <td>Distance: {{ run.distance|floatformat:-2|intcomma }}</td>
                    <td>Date: {{ run.start_date }}{% if run.end_date != run.start_date %} - {{ run.end_date }} {% endif %}</td>
                </tr>
        {% endfor %}
        </table>

        {% if own_page %}
            <h4><a href="{% url 'Running.views.input_run' user.id %}" class="btn btn-default"> Input a run! </a></h4>

            <h4><a href="{% url 'Running.views.register_runkeeper' user.id %}" class="btn btn-default"> Register with runkeeper! </a></h4>

        {% endif %}

    {% endif %}

    {% if is_sponsor %}

            Sponsoring: </br>
            <table class="table table-hover">
            <thead>
                <th>Runner</th>
                <th>Rate(kr/km)</th>
                <th>Maximum Possible Amount (kr)</th>
                <th>Continues Until</th>
                <th>Amount Earned (kr)</th>

            </thead>
            {% for sponsorship in sponsorships_given %}
                {% if sponsorship.is_active %}
                    <tr> 
                        <td>{{ sponsorship.runner }}</td>
                        <td>{{ sponsorship.rate }}</td>
                        <td>{{ sponsorship.max_amount }}</td>
                        <td>{{ sponsorship.end_date }}</td>
                        <td>{{ sponsorship.total_amount|floatformat:-2|intcomma }}</td>

                        {% if own_page or sponsorship.sponsor == user %}
                            <td><a href="{% url 'Running.views.end_sponsorship' sponsorship.id user.id %}" class="btn btn-default">End Sponsorship</a></td>
                        {% endif %}
                    </tr>
                {% else %}
                    <tr style='opacity:0.6'> 
                        <td>{{ sponsorship.runner }}</td>
                        <td>{{ sponsorship.rate }}</td>
                        <td>{{ sponsorship.max_amount }}</td>
                        <td>{{ sponsorship.end_date }}</td>
                        <td>{{ sponsorship.total_amount|floatformat:-2|intcomma }}</td>
                    </tr>
                {% endif %}


            {% empty %}
            <tr><td>Hmm, there don't seem to be any sponsorships here.</td></tr>
            {% endfor %}
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td align='right'>Total Amount Donated: </td>
                    <td>{{ amount_given|floatformat:-2|intcomma }}kr</td>
                    <td></td>

                </tr>
            </table>

    {% endif %}

    {% if not is_sponsor and not is_runner %}

        {% if own_page %}

        <h4><a href="{% url 'Running.views.input_run' user.id %}" class="btn btn-default"> Input a run! </a></h4>

        <h4><a href="{% url 'Running.views.register_runkeeper' user.id %}" class="btn btn-default"> Register with runkeeper! </a></h4>

        {% else %}

        <h4><a href="{% url 'Running.views.sponsor' user.id %}" class="btn btn-default"> Sponsor {{ user.username }}! </a></h4>

        {% endif %}

    {% endif %}


{% else %}

<h4>Sorry, this user has chosen to make their information private.</h4>

{% endif %}


{% endblock %}