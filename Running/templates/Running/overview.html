{% extends "masanga_base.html" %}
{% load i18n %}


{% block title %}{% blocktrans %}Overview{% endblocktrans %}{% endblock %}

{% block head %}{% blocktrans %}Overview{% endblocktrans %}{% endblock %}

{% block body %}
    {% if request.user.is_staff %}
        <div class="panel panel-default">
        <div class="panel-heading"><h4>{% trans "All sponsorships" %}</h4></div>
        <table class="table table-hover">
        <thead>
            <th>{% trans "Sponsor" %}</th>
            <th>{% trans "Runner" %}</th>
            <th>{% trans "Rate" %}</th>
            <th>{% trans "Amount Earned" %}</th>
            <th>{% trans "Amount Paid" %}</th>
            <th>{% trans "Amount Left to Pay" %}</th>
            <th>{% trans "Max Amount" %}</th>
            <th>{% trans "Started" %}</th>
            <th>{% trans "Continues Until" %}</th>
            <th>{% trans "Active" %}</th>
            <th>{% trans "Change Total Amount Paid" %}</th>
        </thead>
        {% for sponsorship in sponsorships %}
            {% if sponsorship.sponsor %}
                <tr>
                    <td><a href="{{ sponsorship.get_admin_url }}">{{ sponsorship.sponsor }}</td>
                    <td>{{ sponsorship.runner }}</td>
                    <td>{{ sponsorship.rate }}</td>
                    <td>{{ sponsorship.total_amount }}</td>
                    <td>{{ sponsorship.amount_paid }}</td>
                    <td>{{ sponsorship.left_to_pay }}</td>
                    <td>{{ sponsorship.max_amount }}</td>
                    <td>{{ sponsorship.start_date }}</td>
                    <td>{{ sponsorship.end_date }}</td>
                    <td>{{ sponsorship.is_active}}</td>
                    <td>
                        <form class="form-inline" id="paid_amount_{{ sponsorship.id }}"method="post" action="{% url 'Running.views.overview' %}">
                            {% csrf_token %}
                            <input type="hidden" name="sponsorship_id" value="{{ sponsorship.id }}" />
                            <div class="input-group" value="{{ sponsorship.amount_paid }}">
                                {{ form.amount|default:sponsorship.amount_paid }}
                                <span class="input-group-btn">
                                    <button class="btn btn-default" type="submit">
                                        Submit
                                    </button>
                                </span>
                            </div>
                        </form>
                        <script>
                            document.getElementById('paid_amount_{{ sponsorship.id }}').elements['amount'].value = {{ sponsorship.amount_paid }};
                        </script>
                    </td>
                </tr>
            {% endif %}
        {% endfor %}
        </table>
    </div>

    <div class="panel panel-default">
        <div class="panel-heading"><h4>{% trans "All Wagers" %}</h4></div>
        <table class="table table-hover">
        <thead>
            <th>{% trans "Sponsor" %}</th>
            <th>{% trans "Runner" %}</th>
            <th>{% trans "Amount" %}</th>
            <th>{% trans "Fulfilled" %}</th>
            <th>{% trans "Paid" %}</th>
            <th>{% trans "Remind Date" %}</th>
            <th>{% trans "Decision Date" %}</th>
            <th>{% trans "Wager Text" %}</th>
            <th>{% trans "Update Text" %}</th>

        </thead>
        {% for wager in wagers %}
            {% if wager.sponsor %}
                <tr>
                    <td><a href="{{ wager.get_admin_url }}">{{ wager.sponsor }}</td>
                    <td>{{ wager.runner }}</td>
                    <td>{{ wager.amount }}</td>
                    <td>{{ wager.fulfilled }}</td>
                    <td>{{ wager.paid }}</td>
                    <td>{{ wager.remind_date }}</td>
                    <td>{{ wager.decision_date }}</td>
                    <td>{{ wager.wager_text }}</td>
                    <td>{{ wager.update_text }}</td>
                </tr>
            {% endif %}
        {% endfor %}
        </table>
    </div>

        <div class="panel panel-default">
        <div class="panel-heading"><h4>{% trans "All Users" %}</h4></div>
        <table class="table table-hover">
        <thead>
            <th>{% trans "Username" %}</th>
            <th>{% trans "Email" %}</th>
            <th>{% trans "Is public" %}</th>
            <th>{% trans "Amount Earned" %}</th>
            <th>{% trans "Amount Donated" %}</th>
        </thead>
        {% for user in all_users %}
                <tr>
                    <td><a href="{{ user.get_admin_url }}">{{ user.username }}</a></td>
                    <td>{{ user.email }}</td>
                    <td>{{ user.is_public }}</td>
                    <td>{{ user.amount_earned }}</td>
                    <td>{{ user.amount_donated }}</td>
                </tr>
        {% endfor %}
        </table>
    </div>
    <div class="panel panel-default">
    <div class="panel-heading"><h4>{% trans "All email addresses" %}</h4></div>
    <table class="table table-hover">

        {% for email in all_emails %}
            {% if email %}
                <tr>
                    <td>{{ email }}</td>
                </tr>
            {% endif %}
        {% endfor %}
    </table>
    </div>

    <div class="panel panel-default">
    <div class="panel-heading"><h4>{% trans "Newsletter email addresses" %}</h4></div>
    <table class="table table-hover">

        {% for email in newsletter_emails %}
            {% if email %}
                <tr>
                    <td>{{ email }}</td>
                </tr>
            {% endif %}
        {% empty %}
            <tr>
                <td>No users currently want the newsletter</td>
            </tr>
        {% endfor %}
    </table>
    </div>

    {% else %}
    {% trans "Sorry, you need to be an admin to access this page." %}
    {% endif %}
{% endblock %}